<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clasificador de Artículos Médicos</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="background-elements">
        <div class="floating-element element-1"></div>
        <div class="floating-element element-2"></div>
        <div class="floating-element element-3"></div>
    </div>

    <div class="container">
        <header class="header">
            <div class="header-icon">
                <i class="fas fa-stethoscope"></i>
            </div>
            <h1>Clasificador de Artículos Médicos</h1>
            <p class="subtitle">Análisis inteligente con IA para clasificación médica</p>
        </header>

        <div class="main-content">
            <div class="form-section">
                <form id="prediction-form" class="prediction-form">
                    <div class="form-group">
                        <label for="title">
                            <i class="fas fa-heading"></i>
                            Título del Artículo
                        </label>
                        <textarea id="title" rows="2" placeholder="Ingresa el título del artículo médico..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="abstract">
                            <i class="fas fa-file-text"></i>
                            Resumen del Artículo
                        </label>
                        <textarea id="abstract" rows="8" placeholder="Ingresa el resumen o abstract del artículo..."></textarea>
                    </div>
                    
                    <button type="submit" class="submit-btn">
                        <i class="fas fa-brain"></i>
                        <span>Analizar con IA</span>
                    </button>
                </form>
            </div>

            <div id="loading" class="loading">
                <div class="spinner">
                    <div class="spinner-inner"></div>
                </div>
                <p>Analizando contenido...</p>
            </div>
            
            <div id="result-container" class="result-container">
                <div class="result-header">
                    <i class="fas fa-chart-line"></i>
                    <h2>Resultados del Análisis</h2>
                </div>
                <div id="results" class="results">
                    <div class="placeholder">
                        <i class="fas fa-robot"></i>
                        <p>Los resultados de la clasificación aparecerán aquí</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('prediction-form').addEventListener('submit', async function(event) {
            event.preventDefault();

            const title = document.getElementById('title').value.trim();
            const abstract = document.getElementById('abstract').value.trim();
            const resultsDiv = document.getElementById('results');
            const loadingDiv = document.getElementById('loading');
            const resultContainer = document.getElementById('result-container');

            // Validación básica
            if (!title || !abstract) {
                showError('Por favor, completa tanto el título como el resumen del artículo.');
                return;
            }

            // Mostrar loading y ocultar resultados anteriores
            loadingDiv.style.display = 'flex';
            resultContainer.classList.remove('show');
            
            const payload = {
                title: title,
                abstract: abstract,
                threshold: 0.5
            };

            try {
                const response = await fetch('http://127.0.0.1:5000/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();

                if (data.success) {
                    displayResults(data.data);
                } else {
                    showError(`Error en la predicción: ${data.error}`);
                }
            } catch (error) {
                showError(`Error al conectar con la API: ${error.message}`);
            } finally {
                loadingDiv.style.display = 'none';
            }
        });

        function displayResults(prediction) {
            const resultsDiv = document.getElementById('results');
            const resultContainer = document.getElementById('result-container');
            
            let htmlContent = '';
            
            // Etiquetas predichas
            htmlContent += '<div class="prediction-section">';
            htmlContent += '<h3><i class="fas fa-tags"></i> Etiquetas Predichas</h3>';
            
            if (prediction.etiquetas_predichas.length > 0) {
                htmlContent += '<div class="labels-grid">';
                prediction.etiquetas_predichas.forEach(label => {
                    const probability = (prediction.probabilidades[label] * 100).toFixed(1);
                    htmlContent += `
                        <div class="label-card predicted">
                            <i class="fas fa-check-circle"></i>
                            <span class="label-name">${label}</span>
                            <span class="probability">${probability}%</span>
                        </div>
                    `;
                });
                htmlContent += '</div>';
            } else {
                htmlContent += '<div class="no-predictions"><i class="fas fa-info-circle"></i> No se predijo ninguna etiqueta para el umbral dado.</div>';
            }
            htmlContent += '</div>';

            // Todas las probabilidades
            htmlContent += '<div class="probability-section">';
            htmlContent += '<h3><i class="fas fa-percentage"></i> Todas las Probabilidades</h3>';
            htmlContent += '<div class="probability-list">';
            
            // Ordenar probabilidades de mayor a menor
            const sortedProbs = Object.entries(prediction.probabilidades)
                .sort(([,a], [,b]) => b - a);
            
            sortedProbs.forEach(([label, proba]) => {
                const percentage = (proba * 100).toFixed(1);
                const isPredicted = prediction.etiquetas_predichas.includes(label);
                htmlContent += `
                    <div class="probability-item ${isPredicted ? 'predicted' : ''}">
                        <div class="prob-label">
                            ${isPredicted ? '<i class="fas fa-star"></i>' : '<i class="fas fa-circle"></i>'}
                            ${label}
                        </div>
                        <div class="prob-bar">
                            <div class="prob-fill" style="width: ${percentage}%"></div>
                        </div>
                        <div class="prob-value">${percentage}%</div>
                    </div>
                `;
            });
            
            htmlContent += '</div>';
            htmlContent += '</div>';

            resultsDiv.innerHTML = htmlContent;
            resultContainer.classList.add('show');
        }

        function showError(message) {
            const resultsDiv = document.getElementById('results');
            const resultContainer = document.getElementById('result-container');
            
            resultsDiv.innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>${message}</p>
                </div>
            `;
            
            resultContainer.classList.add('show', 'error');
            setTimeout(() => resultContainer.classList.remove('error'), 300);
        }

        // Animación de elementos flotantes
        function animateFloatingElements() {
            const elements = document.querySelectorAll('.floating-element');
            elements.forEach((el, index) => {
                el.style.animationDelay = `${index * 2}s`;
            });
        }

        // Inicializar animaciones cuando carga la página
        document.addEventListener('DOMContentLoaded', animateFloatingElements);
    </script>
</body>
</html>